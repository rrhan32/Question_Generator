"use strict";!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).ReactCoolForm={},e.React)}(this,(function(e,r){function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t,n=arguments[r];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function n(e,r){if(null==e)return{};var t,n={},u=Object.keys(e);for(t=0;t<u.length;t++){var i=u[t];0<=r.indexOf(i)||(n[i]=e[i])}return n}function u(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&u(e[n],r[n]););return-1===n}if(!t||"object"==typeof e){for(t in n=0,e)if(a.call(e,t)&&++n&&!a.call(r,t)||!(t in r)||!u(e[t],r[t]))return!1;return Object.keys(r).length===n}}return e!=e&&r!=r}var i,a=Object.prototype.hasOwnProperty,o={},c=function(e){return e?o[e]:i},s=function(e){var t=r.useRef(e);return t.current=e,t},l=function(e,r){return void 0===r&&(r={}),e.reduce((function(e,t){return e[r[t]||t]=!0,e}),{})},f=function(e){return null!==e&&"object"==typeof e},d=function e(r){if(r instanceof Event)throw Error("Unable to clone event.");return!f(r)||r instanceof FileList?r:r instanceof Date?new Date(r.getTime()):Array.isArray(r)?r.map((function(r){return e(r)})):Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{})},v=function(e){return!Array.isArray(e)&&!(e instanceof Date)&&f(e)},h=function e(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];return t.reduce((function(r,t){return Object.keys(t).forEach((function(n){var u=r[n],i=t[n];Array.isArray(u)&&Array.isArray(i)?r[n]=[].concat(u,i):v(u)&&v(i)?r[n]=e(u,i):r[n]=i})),r}),{})},y=function e(r,t){return v(r)?Object.keys(r).reduce((function(n,u){var i=e(r[u],t[u]||!1);return void 0!==i?n[u]=i:delete n[u],n}),{}):t?r:void 0},b=function(e){if("string"!=typeof e)throw new TypeError("Expected a string.");return e.length?e.split(/[.[\]]+/).filter(Boolean):[]},m=function(e,r,t){return v(e)&&r&&void 0!==(e=b(r).reduce((function(e,r){return(e||{})[r]}),e))?e:t},p=function(e){return!!function e(r,t){void 0===t&&(t=[]);var n=0;for(r=Object.values(r);n<r.length;n++){var u=r[n];if(!0===u){t.push(u);break}f(u)&&e(u,t)}return t}(e).length},g=function(e){return"values touched errors isDirty dirty isValidating isValid isSubmitting isSubmitted submitCount".split(" ").some((function(r){return e.startsWith(r)}))?e:"values."+e},k=function(e){return"function"==typeof e},C=function(e){return k(e)&&"AsyncFunction"===e.constructor.name},A=function(e){return v(e)&&!Object.keys(e).length},E=function(e,r,t){var n;return Object.keys(e).some((function(e){return!!r.startsWith(e)&&(n=e,t&&t(e),!0)})),n},S=function(e){return"select-multiple"===e.type},V=function(e,r,t,n,u){if(void 0===t&&(t=g),!e)return u?r:void 0;if(Array.isArray(e))u=e.map((function(e){e=t(e);var u=m(r,e);return n?n(e,u):u}));else if(v(e)){var i=e;u=Object.keys(i).reduce((function(u,a){e=t(i[a]);var o=m(r,e);return u[a]=n?n(e,o):o,u}),{})}else e=t(e),u=m(r,e),u=n?n(e,u):u;return u},R=function(e,r,t,n){if(!v(e))throw new TypeError("Expected an object.");e=n?d(e):e;var u=b(r);return u.slice(0,-1).reduce((function(e,r,t){return t=!Number.isNaN(+u[t+1]),v(e[r])&&!t||Array.isArray(e[r])&&t||(e[r]=t?[]:{}),e[r]}),e)[u[u.length-1]||""]=t,e},T=function e(r){return!Array.isArray(r)&&!v(r)||(Array.isArray(r)?r.map((function(r){return e(r)})):Object.keys(r).reduce((function(t,n){return t[n]=e(r[n]),t}),{}))},O=function e(r,t,n){if(!v(r))throw new TypeError("Expected an object.");if((r=n?d(r):r).hasOwnProperty(t))return delete r[t],r;if(!(t=b(t)).length)return r;n=t.pop();var u=t.reduce((function(e,r){return(e||{})[r]}),r);if(Array.isArray(u)){var i=+n;if(i<u.length-1)delete u[i];else for(;0<=i&&(i==n||void 0===u[i]);)u.splice(i,1),--i}else v(u)&&delete u[n];return A(u)||Array.isArray(u)&&!u.filter((function(e){return void 0!==e})).length?e(r,t.join(".")):r},D=function(e,n){var i=r.useReducer((function(e){return e+1}),0)[1],a=r.useRef(e),o=r.useRef([{usedState:{},notify:i}]),c=s(n||function(){});return e=r.useCallback((function(e,r,n){var i=void 0===n?{}:n;n=i.fieldPath;var s=i.shouldSkipUpdate,l=i.shouldForceUpdate;if(i=e.split(".")[0]){if("values"!==e&&"values"===i||!u(m(a.current,e),r)){var f=R(a.current,e,r,!0),d=f.errors,v=f.dirty,h=f.isDirty,y=f.isValid,b=f.submitCount,g=f.submitCount,k="dirty"===i?p(v):h,C="errors"===i?A(d):y,E="isSubmitting"===i&&r?g+=1:g;a.current=t({},f,{isDirty:k,isValid:C,submitCount:E}),c.current(a.current),s||(e=n||e,o.current.forEach((function(r){var t=r.usedState;return r=r.notify,(l||Object.keys(t).some((function(r){return e.startsWith(r)||r.startsWith(e)}))||t.isDirty&&k!==h||t.isValid&&C!==y||t.submitCount&&E!==b)&&r(a.current)})))}}else u(a.current,r)||(a.current=r,c.current(a.current),o.current.forEach((function(e){var r=e.notify;return!A(e.usedState)&&r(a.current)})))}),[c]),{stateRef:a,setStateRef:e,observersRef:o}},j=["defaultValue"],F=["validate"],w=function(e,n,u){var i=k(n)?{}:n;u=c((null==i?void 0:i.formId)||u);var a=r.useRef(),o=r.useReducer((function(e){return e+1}),0)[1],s=u.observersRef;u=u.getFormState;var l=k(n)?n:void 0;return r.useEffect((function(){return s.current.push(a.current),function(){s.current=s.current.filter((function(e){return e!==a.current}))}}),[]),u(e,t({},i,{methodName:l?"useFormStateCallback":"useFormState",callback:function(r){a.current||(a.current={usedState:r,notify:l?function(r){return l(V(e,r))}:o})}}))},N="formId defaultValue validate parse format errorWithTouched".split(" "),x=["onChange","onBlur"];e.get=m,e.set=R,e.unset=O,e.useControlled=function(e,u){var i,a=void 0===u?{}:u,o=a.formId,s=a.defaultValue,l=a.validate,f=a.parse;u=a.format;var d=a.errorWithTouched;a=n(a,N);var v=c(o);o=w({value:"values."+e,error:"errors."+e,isTouched:"touched."+e,isDirty:"dirty."+e},{formId:o,errorWithTouched:d});var h=v.shouldRemoveField,y=v.initialStateRef,b=v.fieldArrayRef;d=v.controlsRef;var p=v.fieldValidatorsRef,g=v.changedFieldRef,k=v.getState,C=v.getNodeValue,A=v.setDefaultValue,S=v.setTouchedMaybeValidate,V=v.handleChangeEvent,R=v.removeField;r.useEffect((function(){var r=E(b.current,e),t=m(y.current.values,e);return void 0===t?void 0===s||r&&void 0===m(y.current.values,e.split(".")[0])||A(e,s):void 0===k(e)&&A(e,t),function(){h(e)&&R(e,r&&void 0!==m(y.current.values,e.split(".")[0])?["defaultValue"]:void 0)}}),[]),d.current[e]=!0,l&&(p.current[e]=l);var T=a.onChange,O=a.onBlur;return l=n(a,x),a=m(y.current.values,e),a=void 0!==o.value?o.value:void 0!==a?a:s,a=null!=(i=u?u(a):a)?i:"",[t({name:e,value:a,onChange:function(){if(f)var r=f.apply(void 0,arguments);else r=(null==(r=0>=arguments.length?void 0:arguments[0])?void 0:r.nativeEvent)instanceof Event&&/INPUT|TEXTAREA|SELECT/.test(r.target.tagName)?C(e):r;V(e,r),T&&T.apply(void 0,arguments),g.current=e},onBlur:function(r){S(e),O&&O(r),g.current=void 0}},l),{error:o.error,isTouched:!!o.isTouched,isDirty:!!o.isDirty}]},e.useFieldArray=function(e,n){var u=(n=void 0===n?{}:n).defaultValue,i=n.validate,a=(n=c(n.formId)).validateOnChange,o=n.shouldRemoveField,s=n.initialStateRef,l=n.fieldArrayRef,f=n.fieldValidatorsRef,d=n.getState,v=n.setDefaultValue,h=n.setNodesOrValues,y=n.setStateRef,b=n.runValidation,g=n.removeField,k=r.useCallback((function(r){void 0===r&&(r=!1);var t=d(e);return r&&void 0===t&&(t=u),Array.isArray(t)?t.map((function(r,t){return e+"["+t+"]"})):[]}),[d,e]),C=r.useState(k(!0));n=C[0];var A=C[1],E=r.useCallback((function(){A(k()),h(d("values"),{shouldSetValues:!1,fields:Object.keys(l.current[e].fields)})}),[l,k,d,e,h]);r.useEffect((function(){return void 0===m(s.current.values,e)&&void 0!==u&&(v(e,u,!0),E()),function(){o(e)&&g(e)}}),[]),l.current[e]||(l.current[e]={reset:E,fields:{}}),i&&(f.current[e]=i);var S=r.useCallback((function(r,n){var u=(n=void 0===n?{}:n).shouldTouched,i=n.shouldDirty,o=d();["values","touched","errors","dirty"].forEach((function(n){var a,c,s=o[n][e],l=null==(a=o.values[e])?void 0:a.length;("values"===n||"touched"===n&&u||"dirty"===n&&i||void 0!==s)&&(o=R(o,n,t({},o[n],((c={})[e]=r(Array.isArray(s)?[].concat(s):[],n,l?l-1:0),c)),!0))})),y("",t({},o,{shouldDirty:p(o.dirty)})),E(),a&&b(e)}),[d,e,b,y,E,a]);i=r.useCallback((function(e,r){var t=(r=void 0===r?{}:r).shouldTouched,n=void 0===(r=r.shouldDirty)||r;S((function(r,u,i){return void 0===i&&(i=0),"values"===u?r.push(e):("touched"===u&&t||"dirty"===u&&n)&&(r[i]=T(e)),r}),{shouldTouched:t,shouldDirty:n})}),[S]),f=r.useCallback((function(e,r,t){var n=(t=void 0===t?{}:t).shouldTouched,u=void 0===(t=t.shouldDirty)||t;S((function(t,i){return"values"===i?t.splice(e,0,r):"touched"===i&&n||"dirty"===i&&u?t[e]=T(r):e<t.length&&t.splice(e,0,void 0),t}),{shouldTouched:n,shouldDirty:u})}),[S]),C=r.useCallback((function(r){var t=(d(e)||[])[r];return S((function(e){return e.splice(r,1),e.filter(Boolean).length?e:[]})),t}),[d,e,S]);var V=r.useCallback((function(e,r){S((function(t){var n=[t[r],t[e]];return t[e]=n[0],t[r]=n[1],t}))}),[S]),O=r.useCallback((function(e,r){S((function(t){return t.splice(r,0,t.splice(e,1)[0]),t}))}),[S]);return[n,{push:i,insert:f,remove:C,swap:V,move:O}]},e.useForm=function(e){var a=(e=void 0===e?{}:e).id,c=e.defaultValues;c=void 0===c?{}:c;var f=e.validate,d=e.validateOnChange,b=void 0===d||d,p=void 0===(d=e.validateOnBlur)||d,T=void 0===(d=e.focusOnError)||d,w=void 0===(d=e.removeOnUnmounted)||d,N=void 0===(d=e.builtInValidationMode)?"message":d;d=void 0===(d=e.excludeFields)?[]:d;var x=e.onReset,P=e.onSubmit,L=e.onError;e=e.onStateChange;var W=r.useRef({}),U=r.useRef(),I=r.useRef(),M=r.useRef(new Map),B=r.useRef({}),q=r.useRef({}),X=r.useRef({}),_=s(f),z=r.useRef({}),G=r.useRef(),H=r.useRef(l(d)),J=s(x||function(){}),K=s(P||function(){}),Q=s(L||function(){}),Y=r.useRef(!1),Z=r.useRef({values:c,touched:{},errors:{},isDirty:!1,dirty:{},isValidating:!1,isValid:!0,isSubmitting:!1,isSubmitted:!1,submitCount:0}),$=(e=D(t({},Z.current),e)).stateRef,ee=e.setStateRef,re=e.observersRef,te=r.useCallback((function(e,r){var n=e.split("."),u=n.shift();ee(u,O($.current[u],n.join("."),!0),t({fieldPath:e},r))}),[ee,$]),ne=r.useCallback((function(e){var r,t,n=(null==(r=M.current.get(e))?void 0:r.field)||(null==(t=M.current.get(Array.from(M.current.keys()).find((function(r){return r.startsWith(e)}))||""))?void 0:t.field);n&&k(n.focus)&&n.focus()}),[]),ue=r.useCallback((function(e){return Array.from(e.querySelectorAll("input,textarea,select")).filter((function(e){var r=e.name,t=e.id,n=e.classList,u=e.dataset.rcfExclude,i=H.current;return!(/button|image|submit|reset/.test(e.type)||t&&i["#"+t]||Array.from(n).find((function(e){return i["."+e]}))||"true"!==u&&!r)&&(X.current[r]||"true"!==u&&!i[r])})).reduce((function(e,r){var n,u=r.name,i=E(q.current,u);return i&&(q.current[i].fields[u]=!0),e.set(u,t({},e.get(u),{field:(null==(n=e.get(u))?void 0:n.field)||r})),"checkbox"===r.type||"radio"===r.type?e.get(u).options=e.get(u).options?[].concat(e.get(u).options,[r]):[r]:("select-one"===r.type||S(r))&&(e.get(u).options=Array.from(r.options)),e}),new Map)}),[]),ie=r.useCallback((function(e,r){var t;if(void 0===r&&(r=M.current),r.has(e)){var n=r.get(e);if(r=n.field,n=n.options,"INPUT"===r.tagName){var u,i;if(null!=(u=B.current[e])&&u.valueAsNumber)return r.valueAsNumber;if(null!=(i=B.current[e])&&i.valueAsDate)return r.valueAsDate}return"number"===r.type||"range"===r.type?r.valueAsNumber||"":"checkbox"===r.type?1<n.length?n.filter((function(e){return e.checked})).map((function(e){return e.value})):(e=n[0]).hasAttribute("value")&&e.value?e.checked?[e.value]:[]:e.checked:"radio"===r.type?(null==(t=n.find((function(e){return e.checked})))?void 0:t.value)||"":S(r)?n.filter((function(e){return e.selected})).map((function(e){return e.value})):"file"===r.type?r.files:r.value}}),[]),ae=r.useCallback((function(e,r,t){void 0===t&&(t=M.current),t.has(e)&&!X.current[e]&&(e=(t=t.get(e)).field,t=t.options,"checkbox"===e.type?1<t.length?t.forEach((function(e){e.checked=Array.isArray(r)?r.includes(e.value):!!r})):t[0].checked=!!r:"radio"===e.type?t.forEach((function(e){e.checked=e.value===r})):S(e)&&Array.isArray(r)?t.forEach((function(e){e.selected=!!r.includes(e.value)})):"file"===e.type?(r instanceof FileList&&(e.files=r),r||(e.value="")):e.value=null!=r?r:"")}),[]),oe=r.useCallback((function(e,r,t){void 0===t&&(t=!E(q.current,e)||void 0!==m(Z.current.values,e.split(".")[0])),t&&(Z.current.values=R(Z.current.values,e,r,!0)),u(m($.current.values,e),r)||ee("values."+e,r,{shouldSkipUpdate:!0})}),[ee,$]),ce=r.useCallback((function(e,r){var t=(r=void 0===r?{}:r).shouldSetValues,n=void 0===t||t;return(void 0===(r=r.fields)?Array.from(M.current.keys()):r).forEach((function(r){if(!X.current[r]){var t=m(e,r);void 0!==t&&ae(r,t),n&&oe(r,void 0!==t?t:ie(r))}}))}),[ie,oe,ae]),se=r.useCallback((function(e,r){(r=k(r)?r(m($.current.errors,e)):r)?ee("errors."+e,r):te("errors."+e)}),[te,ee,$]),le=r.useCallback((function(e){e?Array.isArray(e)?e.forEach((function(e){return se(e)})):se(e):ee("errors",{})}),[se,ee]),fe=r.useCallback((function(e){if(!1!==N&&M.current.has(e)){var r=M.current.get(e).field;if(e=r.validity,r=r.validationMessage,"state"===N)for(var t in e)if("valid"!==t&&e[t])return t;return r}}),[N]),de=r.useCallback((function(){return!1===N?{}:Array.from(M.current.keys()).reduce((function(e,r){var n=fe(r);return t({},e,n?R(e,r,n):{})}),{})}),[N,fe]),ve=r.useCallback((async function(e){var r=m($.current.values,e);if(z.current[e]&&void 0!==r)try{return await z.current[e](r,$.current.values)}catch(e){throw e}}),[$]),he=r.useCallback((function(){var e=Object.keys(z.current).map((function(e){return ve(e)}));return Promise.all(e).then((function(e){return Object.keys(z.current).reduce((function(r,n,u){return t({},r,e[u]?R(r,n,e[u]):{})}),{})}))}),[ve]),ye=r.useCallback((async function(e){if(!_.current)return e?void 0:{};try{var r=await _.current($.current.values);return e?m(r,e):v(r)?r:{}}catch(e){throw e}}),[_,$]),be=r.useCallback((async function(e){var r=C(_.current)||C(z.current[e]);r&&ee("isValidating",!0);try{var t=await ye(e)||await ve(e)||fe(e);return se(e,t),r&&ee("isValidating",!1),t}catch(e){return e}}),[_,fe,ve,ye,se,ee]),me=r.useCallback((function(e){return function(e){return(window.requestIdleCallback||function(e){var r=Date.now();return setTimeout((function(){return e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-r))}})}),1)})(e,{timeout:2e3})}((function(){return be(e)}))}),[be]),pe=r.useCallback((function(){return ee("isValidating",!0),Promise.all([de(),he(),ye()]).then((function(e){return e=h.apply(void 0,e),ee("errors",e),ee("isValidating",!1),e}))}),[de,he,ye,ee]),ge=r.useCallback((function(e,r){var t=void 0===(r=(void 0===r?{}:r).shouldFocus)?T:r,n=[];return t&&(n=Array.isArray(t)?t:Array.from(M.current.keys()),n=k(t)?t(n):n),e?Array.isArray(e)?Promise.all(e.map((function(e){return be(e)}))).then((function(r){if(t){var u=n.find((function(t){return!!r[e.indexOf(t)]}));u&&ne(u)}return!r.filter(Boolean).length})):be(e).then((function(r){return t&&r&&n.includes(e)&&ne(e),!r})):pe().then((function(e){if(t){var r=n.find((function(r){return m(e,r)}));r&&ne(r)}return A(e)}))}),[ne,be,pe]),ke=r.useCallback((function(e,r){var t=(r=void 0===r?{}:r).errorWithTouched,n=r.defaultValues,u=void 0===n?{}:n,i=void 0===(n=r.methodName)?"getState":n;r=r.callback;var a={};return e=V(e,$.current,(function(e){return e=g(e),"getState"!==i&&("values"!==e||"useFormStateCallback"===i||Y.current||(Y.current=!0),a[e]=!0),e}),(function(e,r){return"getState"===i?r:e.startsWith("values")?void 0!==r?r:(e=e.replace("values.",""),void 0!==(r=m(Z.current,e))?r:m(u,e)):t&&e.startsWith("errors")?(e=e.replace("errors","touched"),a[e]=!0,y(r,m($.current,e))):r}),"getState"===i),r&&r(a),e}),[$]),Ce=r.useCallback((function(e,r){void 0!==r?setTimeout((function(){return ne(e)}),r):ne(e)}),[ne]);e=r.useCallback((function(e,r){return ke(e,{errorWithTouched:(r=void 0===r?{}:r).errorWithTouched,defaultValues:r.defaultValues,methodName:"use",callback:function(e){re.current[0].usedState=t({},re.current[0].usedState,e)}})}),[ke,re]);var Ae=r.useCallback((function(e){return ke(e)}),[ke]),Ee=r.useCallback((function(e,r,t){void 0===r&&(r=!0),t=void 0===(t=(void 0===t?{}:t).shouldValidate)?p:t,r?ee("touched."+e,!0):te("touched."+e),t&&me(e)}),[te,ee,me,p]),Se=r.useCallback((function(e){return Ee(e,!0,{shouldValidate:b?e!==G.current:void 0})}),[Ee,b]),Ve=r.useCallback((function(e,r){void 0===r&&(r=!0),r?ee("dirty."+e,!0):te("dirty."+e)}),[te,ee]),Re=r.useCallback((function(e){return Ve(e,!u(m($.current.values,e),m(Z.current.values,e)))}),[Ve,$]),Te=r.useCallback((function(e,r,t){var n=void 0===t?{}:t;t=void 0===(t=n.shouldValidate)?b:t;var u=n.shouldTouched;u=void 0===u||u,n=void 0===(n=n.shouldDirty)||n,void 0!==(r=k(r)?r(m($.current.values,e)):r)?ee("values."+e,r):te("values."+e),ae(e,r),E(q.current,e,(function(e){return q.current[e].reset()})),u&&Ee(e,!0,{shouldValidate:!1}),n&&Re(e),t&&me(e)}),[te,Re,ae,ee,Ee,$,me,b]),Oe=r.useCallback((function(){return{getState:Ae,setValue:Te,setTouched:Ee,setDirty:Ve,setError:se,clearErrors:le,runValidation:ge,removeField:Ne,focus:Ce,reset:De,submit:je}}),[]),De=r.useCallback((function(e,r,n){null!=n&&n.preventDefault&&n.preventDefault(),null!=n&&n.stopPropagation&&n.stopPropagation();var u=t({},$.current),i=l(r||[]);Object.keys(u).forEach((function(r){if(!i[r])if("values"===r){var t=(k(e)?e($.current.values):e)||Z.current.values;u[r]=t,Z.current.values=t,ce(t,{shouldSetValues:!1,fields:Array.from(M.current.keys()).filter((function(e){return!E(q.current,e)}))})}else u[r]=Z.current[r]})),ee("",u),J.current(u.values,Oe(),n),Object.values(q.current).forEach((function(e){return e.reset()}))}),[Oe,J,ce,ee,$]),je=r.useCallback((async function(e){null!=e&&e.preventDefault&&e.preventDefault(),null!=e&&e.stopPropagation&&e.stopPropagation();var r=[].concat(Array.from(M.current.keys()),Object.keys(X.current)).reduce((function(e,r){return R(e,r,!0,!0)}),$.current.touched);ee("touched",r),ee("isSubmitted",!1),ee("isSubmitting",!0);try{if(!await ge()){var t=$.current.errors;return Q.current(t,Oe(),e),{errors:t}}return await K.current($.current.values,Oe(),e),ee("isSubmitted",!0),{values:$.current.values}}catch(e){throw e}finally{ee("isSubmitting",!1)}}),[Oe,Q,K,ge,ee,$]),Fe=r.useCallback((function(e,r){ee("values."+e,r),Re(e),b&&me(e)}),[Re,ee,me,b]),we=r.useCallback((function(e){if(!w)return!1;var r=Array.isArray(w)?w:[].concat(Array.from(M.current.keys()),Object.keys(X.current),Object.keys(q.current));return(r=k(w)?w(r):r).includes(e)}),[]),Ne=r.useCallback((function(e,r){var t=(r=l(r||[],{value:"values",error:"errors"})).defaultValue,u=n(r,j);t||(Z.current.values=O(Z.current.values,e,!0)),["values","touched","dirty","errors"].forEach((function(r,t,n){t=t===n.length-1,u[r]||void 0===m($.current[r],e)||te(r+"."+e,{shouldSkipUpdate:!t,shouldForceUpdate:t})})),delete B.current[e],delete z.current[e],delete q.current[e],delete X.current[e],M.current.has(e)&&M.current.delete(e)}),[te,$]);return c=r.useCallback((function(e){if(e){I.current=e;var r=I.current;M.current=ue(r),ce(Z.current.values),W.current.change=function(e){if(e=e.target.name,M.current.has(e)&&!X.current[e]){var r,t=null==(r=B.current[e])?void 0:r.parse;r=ie(e),Fe(e,t?t(r):r),G.current=e}},W.current.blur=function(e){e=e.target,/INPUT|TEXTAREA|SELECT/.test(e.tagName)&&(e=e.name,M.current.has(e)&&!X.current[e]&&(Se(e),G.current=void 0))},W.current.submit=function(e){return je(e)},W.current.reset=function(e){return De(null,null,e)},r.addEventListener("input",W.current.change),r.addEventListener("focusout",W.current.blur),r.addEventListener("submit",W.current.submit),r.addEventListener("reset",W.current.reset),U.current=new MutationObserver((function(e){if("childList"===e[0].type){var t=ue(r),n=Z.current.values;M.current.forEach((function(e,r){var u,i,a;we(r)&&!X.current[r]&&(t.has(r)?(e=null==(u=M.current.get(r))||null==(i=u.options)?void 0:i.length)>(u=null==(a=t.get(r).options)?void 0:a.length)?ee("values."+r,ie(r,t),{shouldSkipUpdate:!0}):e<u&&ae(r,m(n,r),t):Ne(r,E(q.current,r)&&void 0!==m(Z.current.values,r.split(".")[0])?["defaultValue"]:void 0))}));var u=[];t.forEach((function(e,r){M.current.has(r)||X.current[r]||(void 0!==(e=m($.current.values,r))&&(n=R(n,r,e,!0)),u.push(r))})),M.current=t,u.length&&ce(n,{fields:u})}})),U.current.observe(r,{childList:!0,subtree:!0})}}),[ue,ie,Fe,Ne,De,ae,ce,ee,Se,we,$,je]),f=r.useCallback((function(e){return function(r){if(null!=r&&r.name&&!X.current[r.name]&&!H.current[r.name])if(k(e))z.current[r.name]=e;else{var t=e.validate,u=n(e,F);t&&(z.current[r.name]=t),B.current[r.name]=u}}}),[]),function(e,r){e?o[e]=r:i=r}(a,{validateOnChange:b,shouldRemoveField:we,initialStateRef:Z,fieldArrayRef:q,controlsRef:X,observersRef:re,fieldValidatorsRef:z,changedFieldRef:G,setStateRef:ee,getNodeValue:ie,getFormState:ke,setDefaultValue:oe,setNodesOrValues:ce,setTouchedMaybeValidate:Se,handleChangeEvent:Fe,removeField:Ne,form:c,field:f,focus:Ce,use:e,getState:Ae,setValue:Te,setTouched:Ee,setDirty:Ve,setError:se,clearErrors:le,runValidation:ge,reset:De,submit:je}),r.useEffect((function(){return function(){if(I.current){var e,r=W.current;I.current.removeEventListener("input",r.change),I.current.removeEventListener("focusout",r.blur),I.current.removeEventListener("submit",r.submit),I.current.removeEventListener("reset",r.reset),null==(e=U.current)||e.disconnect()}a?delete o[a]:i=void 0}}),[a]),{form:c,field:f,focus:Ce,removeField:Ne,use:e,getState:Ae,setValue:Te,setTouched:Ee,setDirty:Ve,setError:se,clearErrors:le,runValidation:ge,reset:De,submit:je}},e.useFormMethods=function(e){return{form:(e=c(e)).form,field:e.field,focus:e.focus,removeField:e.removeField,use:e.use,getState:e.getState,setValue:e.setValue,setTouched:e.setTouched,setDirty:e.setDirty,setError:e.setError,clearErrors:e.clearErrors,runValidation:e.runValidation,reset:e.reset,submit:e.submit}},e.useFormState=w,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.production.min.js.map
